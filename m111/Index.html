<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Furistic Fashion | AI Stylist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Plus+Jakarta+Sans:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --violet-main: #7c3aed; }
        body { background: #0f172a; font-family: 'Plus Jakarta Sans', sans-serif; color: #ffffff; min-height: 100vh; margin: 0; }
        .brand-gradient { background: linear-gradient(135deg, #a78bfa 0%, #f472b6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .glass-panel { background: rgba(255, 255, 255, 0.94); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.3); }
        .view-hidden { display: none !important; }
        .bot-msg { background: #ffffff; border-left: 4px solid var(--violet-main); color: #1e293b; }
        .user-msg { background: var(--violet-main); color: white; margin-left: auto; border-radius: 1.5rem 1.5rem 0 1.5rem; }
        #camera-view { transform: scaleX(-1); border-radius: 2rem; width: 100%; height: 100%; object-fit: cover; }
        .animate-fade-in { animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="flex flex-col">

    <section id="landing-view" class="min-h-screen flex flex-col w-full bg-[url('https://images.unsplash.com/photo-1490481651871-ab68de25d43d?auto=format&fit=crop&q=80&w=2000')] bg-cover bg-center">
        <div class="absolute inset-0 bg-black/60"></div>
        <nav class="relative z-10 p-8 flex justify-between items-center max-w-7xl mx-auto w-full">
            <h1 class="font-bold text-2xl brand-gradient font-[Orbitron]">AI STYLIST</h1>
            <button onclick="switchView('app-view')" class="bg-white text-black px-6 py-2 rounded-full font-bold">Launch App</button>
        </nav>
        <main class="relative z-10 flex-1 flex flex-col justify-center items-center text-center px-6">
            <h2 class="text-7xl font-bold mb-6 font-[Orbitron]">FURISTIC <span class="brand-gradient">FASHION BOT</span></h2>
            <button onclick="switchView('app-view')" class="bg-violet-600 px-12 py-5 rounded-2xl font-bold hover:bg-violet-700 transition shadow-2xl">Start Scan</button>
        </main>
    </section>

    <section id="app-view" class="view-hidden h-screen w-full flex items-center justify-center p-4">
        <div class="glass-panel w-full max-w-6xl h-[90vh] rounded-[3rem] flex overflow-hidden shadow-2xl">
            <div class="w-1/3 border-r border-violet-100 p-8 hidden md:flex flex-col bg-white/50">
                <button onclick="switchView('landing-view')" class="text-xs font-bold text-violet-600 mb-10 tracking-widest">‚Üê HOME</button>
                <div class="space-y-6">
                    <div>
                        <p class="text-[10px] font-bold text-violet-500 uppercase mb-3">1. Aesthetic Scan</p>
                        <button onclick="startLiveCamera()" class="w-full text-left bg-white p-4 rounded-xl shadow-sm border border-transparent hover:border-violet-400 mb-2 transition">
                            <span class="block text-slate-900 font-bold text-sm">Live Camera scan</span>
                        </button>
                        <button onclick="triggerUpload()" class="w-full text-left bg-white/60 p-4 rounded-xl shadow-sm hover:bg-white transition">
                            <span class="block text-slate-900 font-bold text-sm">Upload Photo</span>
                        </button>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold text-violet-500 uppercase mb-3">2. Body Type</p>
                        <button onclick="showBodyTypeGrid()" class="w-full text-left bg-white p-4 rounded-xl shadow-sm border border-transparent hover:border-violet-400 transition">
                            <span class="block text-slate-900 font-bold text-sm">Silhouette Analysis</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex-1 flex flex-col bg-white relative">
                <div id="chat-window" class="flex-1 overflow-y-auto p-8 space-y-6">
                    <div class="bot-msg p-6 rounded-3xl text-sm animate-fade-in">  Welcome to Furistic. Ready to define your 2026 Aesthetic? Start a <b>Vision Scan</b> for color theory or use the <b>Silhouette Lab</b> for body geometry analysis.</div>
                </div>
                <div id="cam-container" class="hidden absolute inset-0 bg-black/95 z-50 flex flex-col items-center justify-center p-6">
                    <video id="camera-view" autoplay playsinline class="max-w-md w-full aspect-[3/4] border-4 border-white/20 rounded-[2rem]"></video>
                    <button onclick="captureImage()" class="mt-8 bg-white text-black px-12 py-4 rounded-full font-bold">CAPTURE</button>
                </div>
                <div class="p-8 border-t border-violet-100 flex gap-4">
                    <input id="user-input" type="text" placeholder="Type a message..." class="flex-1 bg-slate-100 rounded-2xl px-6 text-slate-800 outline-none">
                    <button onclick="handleChat()" class="bg-violet-600 text-white px-8 py-4 rounded-2xl font-bold">SEND</button>
                </div>
            </div>
        </div>
    </section>

    <section id="body-results-view" class="view-hidden min-h-screen w-full bg-slate-50 text-slate-900 p-8 flex items-center justify-center">
        <div class="max-w-6xl w-full grid md:grid-cols-2 gap-12 animate-fade-in">
            <div id="body-img-box" class="rounded-[3rem] overflow-hidden shadow-2xl border-[12px] border-white h-[600px] bg-slate-200"></div>
            <div class="flex flex-col justify-center">
                <button onclick="switchView('app-view')" class="text-violet-600 font-bold text-xs mb-4">‚Üê BACK TO LAB</button>
                <h2 id="body-title" class="text-5xl font-black mb-6 font-[Orbitron]">Strategy</h2>
                <div id="body-content" class="space-y-6"></div>
            </div>
        </div>
    </section>

    <section id="aesthetic-results-view" class="view-hidden min-h-screen w-full bg-[#faf9f6] text-slate-900 p-8 flex items-center justify-center">
        <div class="max-w-7xl w-full grid lg:grid-cols-3 gap-8 animate-fade-in">
            <div class="lg:col-span-1">
                <button onclick="switchView('app-view')" class="text-violet-600 font-bold text-xs mb-4 block">‚Üê BACK TO SCAN</button>
                
            </div>
            <div class="lg:col-span-1 flex flex-col justify-center space-y-8">
                <div>
                    <p class="text-violet-500 font-bold uppercase tracking-widest text-xs mb-2">Detected Undertone</p>
                    <h2 id="aes-title" class="text-5xl font-bold font-[Orbitron]">Cool Summer</h2>
                </div>
                <div class="space-y-4">
                    <p class="text-slate-400 font-bold uppercase text-[10px]">Your Power Palette</p>
                    <div id="aes-colors" class="flex gap-4"></div>
                </div>
            </div>
            <div class="lg:col-span-1 bg-white p-10 rounded-[3rem] shadow-sm border border-slate-100 flex flex-col justify-center">
                <h3 class="text-2xl font-bold mb-8 border-b pb-4">Jewelry Lab</h3>
                <div id="aes-jewelry" class="space-y-8">
                    </div>
            </div>
        </div>
    </section>

    <canvas id="capture-canvas" class="hidden"></canvas>

    <script>
        const chatWindow = document.getElementById('chat-window');
const video = document.getElementById('camera-view');
const userInput = document.getElementById('user-input');
let stream = null;

// Helper to switch between different UI screens
function switchView(viewId) {
    document.querySelectorAll('section').forEach(s => s.classList.add('view-hidden'));
    document.getElementById(viewId).classList.remove('view-hidden');
}

// Helper to add messages to the chat interface
function appendMsg(sender, html) {
    const div = document.createElement('div');
    div.className = `${sender === 'user' ? 'user-msg' : 'bot-msg'} p-6 rounded-3xl text-sm max-w-[85%] animate-fade-in mb-4 shadow-sm`;
    div.innerHTML = html;
    chatWindow.appendChild(div);
    chatWindow.scrollTo({ top: chatWindow.scrollHeight, behavior: 'smooth' });
}

// --- AESTHETIC / COLOR ANALYSIS LOGIC ---
function triggerUpload() {
    const input = document.createElement('input');
    input.type = 'file';
    input.onchange = (e) => processAesthetic();
    input.click();
}

async function startLiveCamera() {
    try {
        stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
        document.getElementById('cam-container').classList.remove('hidden');
    } catch (err) { alert("Camera Access Denied or Not Found"); }
}

function captureImage() {
    document.getElementById('cam-container').classList.add('hidden');
    if(stream) stream.getTracks().forEach(t => t.stop());
    processAesthetic();
}

async function processAesthetic() {
    appendMsg('bot', "<i>Refracting light... Analyzing metal compatibility...</i>");
    try {
        const res = await fetch('http://localhost:8000/color-analysis', { method: 'POST' });
        const data = await res.json();
        
        setTimeout(() => {
            switchView('aesthetic-results-view');
            document.getElementById('aes-title').innerText = data.undertone;
            
            // Map the colors correctly
            document.getElementById('aes-colors').innerHTML = data.colors.map((c, i) => `
                <div class="flex-1">
                    <div class="h-24 rounded-2xl shadow-inner mb-2" style="background:${c}"></div>
                    <p class="text-[10px] text-center font-bold text-slate-400">${data.color_names[i]}</p>
                </div>
            `).join('');

            // Jewelry Results
            document.getElementById('aes-jewelry').innerHTML = `
                <div class="flex items-start gap-4">
                    <div class="p-3 bg-violet-50 rounded-xl text-violet-600">‚õìÔ∏è</div>
                    <div><p class="text-[10px] font-bold text-slate-400 uppercase">Recommended Metal</p><p class="font-bold text-slate-800">${data.jewelry.metal}</p></div>
                </div>
                <div class="flex items-start gap-4">
                    <div class="p-3 bg-violet-50 rounded-xl text-violet-600">üíé</div>
                    <div><p class="text-[10px] font-bold text-slate-400 uppercase">Earring Selection</p><p class="font-bold text-slate-800">${data.jewelry.earrings}</p></div>
                </div>
                <div class="flex items-start gap-4">
                    <div class="p-3 bg-violet-50 rounded-xl text-violet-600">‚ú®</div>
                    <div><p class="text-[10px] font-bold text-slate-400 uppercase">Necklace/Chain Style</p><p class="font-bold text-slate-800">${data.jewelry.chains}</p></div>
                </div>
            `;
        }, 1000);
    } catch(e) { 
        appendMsg('bot', "Connection error. Ensure your FastAPI server is running at localhost:8000."); 
    }
}

// --- BODY GEOMETRY / SILHOUETTE LAB LOGIC ---
function showBodyTypeGrid() {
    const types = ['Apple', 'Pear', 'Hourglass', 'Rectangle', 'Inverted Triangle'];
    appendMsg('bot', `Please select your silhouette for structural analysis:
        <div class="grid grid-cols-1 gap-2 mt-4">
            ${types.map(t => `<button onclick="selectBodyType('${t}')" class="bg-slate-50 p-4 rounded-xl text-left font-bold hover:bg-violet-100 border border-slate-100 transition-all">${t} Silhouette</button>`).join('')}
        </div>`);
}

async function selectBodyType(type) {
    appendMsg('user', `Analyzing ${type} geometry.`);
    try {
        const res = await fetch('http://localhost:8000/body-analysis', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ body_type: type })
        });
        const data = await res.json();
        
        setTimeout(() => {
            switchView('body-results-view');
            document.getElementById('body-title').innerText = type;
            document.getElementById('body-img-box').innerHTML = `<img src="${data.best_fit_img}" class="w-full h-full object-cover">`;
            document.getElementById('body-content').innerHTML = `
                <p class="text-xl text-slate-500 mb-6">${data.description}</p>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100"><p class="text-[10px] text-slate-400 font-bold">TOPS</p><p class="font-bold text-violet-600">${data.tops}</p></div>
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100"><p class="text-[10px] text-slate-400 font-bold">BOTTOMS</p><p class="font-bold text-violet-600">${data.bottoms}</p></div>
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100"><p class="text-[10px] text-slate-400 font-bold">DRESSES</p><p class="font-bold text-violet-600">${data.dresses}</p></div>
                </div>
            `;
        }, 800);
    } catch(e) { 
        appendMsg('bot', "Server Error. Could not fetch body analysis."); 
    }
}

// --- GENERAL CHAT LOGIC ---
function handleChat() {
    if(!userInput.value) return;
    appendMsg('user', userInput.value);
    const query = userInput.value.toLowerCase();
    userInput.value = '';

    setTimeout(() => {
        if(query.includes("body") || query.includes("silhouette")) {
            showBodyTypeGrid();
        } else if(query.includes("color") || query.includes("skin") || query.includes("scan")) {
            appendMsg('bot', "Initiating scan protocol. Please use the sidebar buttons for 'Aesthetic Scan'.");
        } else {
            appendMsg('bot', "Protocol recognized. How would you like to evolve your style today?");
        }
    }, 1000);
}
    </script>
</body>
</html>